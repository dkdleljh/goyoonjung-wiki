# 자동화 완성 체크리스트 (운영/신뢰성)

## 공식 링크
- (레포) GitHub Actions/CI 설정: .github/workflows/ci.yml

## 출처
- docs/OPERATION_GUIDE.md
- docs/ARCHITECTURE.md


> 목표: "알아서 잘 돌아가는 무인 자동화"를 위해 장애 대응, 관측성, 복구 가능성을 점검.

## 1) 장애/재시도
- [ ] 네트워크 의존 단계는 재시도 정책 존재(횟수/간격 명시)
- [ ] best-effort 단계 실패 시 파이프라인 전체 중단 없음
- [ ] timeout 기본값 정의 및 단계별 상한 적용
- [ ] 실패 사유는 구조화된 파일(`.locks/last-run-reasons.json`)에 기록
- [ ] retry 소진 후 상태가 news 메모에 반영

## 2) 락/동시성/멱등성
- [ ] 단일 실행 락(`flock`) 적용
- [ ] stale lock 복구 정책 존재(연령 기준 + 1회 재획득)
- [ ] 동일 일자 반복 실행 시 결과가 멱등적(중복 커밋/중복 삽입 방지)
- [ ] `seen-urls` 기반 URL 중복 삽입 방지
- [ ] 1일 1커밋 정책 동작 검증

## 3) 관측성/알림
- [ ] health check가 뉴스 상태/이력/git 동기 상태를 검증
- [ ] `git fetch` 실패 시 진단 정보(remote/upstream/HEAD/원격접속성) 출력
- [ ] 주간 링크 헬스 리포트 자동 생성 및 diff 추적
- [ ] 실패 시 운영자가 즉시 판단 가능한 단서(rc, step, note) 보존
- [ ] 외부 알림 훅(예: openclaw wake) 실행 지점 명확화

## 4) 백업/복구
- [ ] 백업 파일은 git 제외(`backups/*.tar.gz`)
- [ ] 일일 백업 생성 정책(중복 방지) 확인
- [ ] 백업 제외 규칙(`.git`, `backups`) 유효성 확인
- [ ] 월 1회 복구 리허설 절차 문서화
- [ ] 최근 N일 백업 보존 정책/정리 정책 정의

## 5) 링크 로트/레이트리밋
- [ ] 링크 체크는 소량 샘플 + 짧은 timeout으로 서비스 부담 최소화
- [ ] 무거운 도메인(youtube/instagram)은 스킵 또는 완화 정책 존재
- [ ] 403/401/redirect를 경고로 분리
- [ ] 동일 도메인 과다 호출 방지(샘플 제한 또는 도메인 스로틀)
- [ ] 차단 도메인 재시도 빈도 제한

## 6) 데이터 무결성/감사로그
- [ ] 실행 상태(최신 1건)와 실행 이력(append-only) 분리 유지
- [ ] 단계별 skip/error 이유가 뉴스 문서에 반영
- [ ] 변경 없는 실행은 no-op 커밋 처리
- [ ] 자동 생성 산출물(`__pycache__`, `*.pyc`) git 미추적 보장
- [ ] 주요 자동 파일 쓰기는 원자적 쓰기 또는 실패-safe 처리

## 7) 운영 안전장치
- [ ] 강제 중단 신호 후에도 상태 정리(trap/on_exit) 수행
- [ ] 권한/경로 오류 시 명확한 stderr 진단 출력
- [ ] 불필요한 push/force-push 최소화 및 조건 분기 명확화
- [ ] 로컬 환경 차이(TZ/path/python)로 인한 오동작 방지
- [ ] 점검 스크립트는 비정상 상태를 fail-fast로 보고
